#!/usr/bin/env python3

import os
import sys

replaces = {
	'--uefi': ['-bios', '/usr/share/OVMF/OVMF.fd'],
	'--usernet': ['-net', 'nic,model=e1000', '-net', 'user'],
	'--spicy': [
		'-usbdevice', 'tablet',
		'-vga', 'qxl',
		'-device', 'virtio-serial-pci',
		'-spice', 'unix=on,addr=/tmp/vm_spice.socket,disable-ticketing=on',
		'-device', 'virtserialport,chardev=spicechannel0,name=com.redhat.spice.0',
		'-chardev', 'spicevmc,id=spicechannel0,name=vdagent',
	],
	'--vnc': [
		'-usbdevice', 'tablet',
		'-vga', 'qxl',
		'-vnc', ':0',
	],
	'--gpu': [
		'-device', 'vfio-pci,host=0a:00.0,x-vga=on,multifunction=on',
		'-device', 'vfio-pci,host=0a:00.1,multifunction=on',
	],
	'--evdev': [
		'-object', 'input-linux,id=mouse1,evdev=/dev/input/event28',
		'-object', 'input-linux,id=kbd1,evdev=/dev/input/by-id/usb-Keychron_Keychron_K2-event-kbd,grab_all=on,repeat=on',
	],
	"--drive=windows": [
		'-drive', 'file=/dev/sda,format=raw',
	],
	'--pulse': [
		'-audio', 'driver=pa,model=hda,server=/run/user/1000/pulse/native',
	]
}

new_args = [
	'qemu-system-x86_64',
	'-cpu', 'host',
	'-accel', 'kvm',
]

for arg in sys.argv[1:]:
	if arg in replaces:
		new_args.extend(replaces[arg])
	else:
		new_args.append(arg)


os.execvp('qemu-system-x86_64', new_args)
